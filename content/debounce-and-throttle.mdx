---
title: '防抖和节流'
publishedAt: '2023-07-02'
image: '/images/debounce-and-throttle-og.png'
summary: '函数防抖和节流是前端开发中常用的性能优化技术。防抖延迟执行函数，减少重复操作；节流控制函数执行频率，避免过度调用。例如，防抖可用于输入框搜索请求，节流可用于页面滚动图片加载。本文介绍原理、实现和应用场景。'
---

假设我们需要监听用户在搜索框输入文字时发送搜索请求。通过函数防抖，我们可以确保只有在用户停止输入一段时间后才发送搜索请求，避免了频繁的网络请求。而在页面滚动时加载图片的场景中，函数节流可以控制每隔一定时间加载一张图片，避免了过多的网络请求同时发起。

<Image
  src="/images/debounce-and-throttle.png"
  width={832}
  height={197}
  alt="Debounce and Throttle"
  priority
/>

## 定义

- 防抖：n 秒后再执行该事件，若在 n 秒内重新触发，则重新计时
- 节流：n 秒内只运行一次，若在 n 秒内重复触发，只有一次生效

经典比喻：

打游戏时，英雄人物的回城过程。当你按下回城键的时候，那么在7秒钟之后，就会执行回城的动作。假如这时候，旁边的野怪打断了你一下，那么回城时间将会重置，又需要重新过7秒才能回城。这就是防抖，多次的高频操作做到触发最后一次。

同样是打游戏，英雄技能每释放一次技能之后都需要冷却时间，这个技能必须等到 cd 转完以后才能释放下一次技能。这就是节流，规定的时间内只能执行一次。

## 代码实现

### 防抖

```js
function debounce(fn, delay) {
  let timerId

  return function() {
    const ctx = this
    const args = arguments

    clearTimeout(timeout)

    timerId = setTimeout(function() {
      fn.apply(context, args)
    }, delay)
  }
}
```

### 节流

```js
function throttle(fn, delay) {
  let lastExecTime = 0

  return function() {
    const ctx = this
    const args = arguments
    const currentTime = Date.now()
    
    // 判断距离上次执行函数的时间间隔是否超过 delay
    if (currentTime - lastExecTime > delay) {
      func.apply(ctx, args)
      // 更新上次执行函数的时间
      lastExecTime = currentTime
    }
  }
}
```

## 区别

相同点：

- 性能优化： 两者都用于减少不必要的函数执行次数，从而提升页面性能和用户体验
- 应用场景： 两者都可以应用于需要控制函数执行频率的场景，如输入框搜索、页面滚动加载等

不同点：

- 执行时机：
  - 函数防抖在事件停止触发一段时间后执行一次函数
  - 函数节流在固定时间间隔内执行一次函数，不管事件触发频率多高

- 执行方式：
  - 函数防抖是在事件停止触发一段时间后执行一次函数，如果在这段时间内再次触发了相同事件，则会重新计时
  - 函数节流是在固定时间间隔内执行一次函数，不管事件触发频率多高，每个时间间隔内只执行一次函数

- 适用场景：
  - 函数防抖适用于需要等待事件停止后再执行的场景，如输入框搜索
  - 函数节流适用于需要控制函数执行频率的场景，如页面滚动加载

## 应用场景

防抖：

- 输入框搜索：当用户在输入框中连续输入时，使用函数防抖可以确保只有在用户停止输入一段时间后才执行搜索请求，减少不必要的请求次数，提升搜索性能
- 窗口大小调整：当用户调整浏览器窗口大小时，使用函数节流可以确保在一定时间内只执行一次调整相关的布局或样式，避免过度渲染，提升页面响应速度
- 按钮点击事件：在某些场景下，用户可能会频繁点击某个按钮，例如提交表单或发送请求。使用函数防抖可以确保只有在用户点击按钮后一段时间内才执行相应的操作，避免多次点击导致的重复提交或请求

节流

- 页面滚动加载：在网页中实现滚动加载功能时，使用函数节流可以控制每隔一定时间加载一次内容，避免频繁触发滚动事件导致性能下降
- 鼠标移入移出事件：当用户在页面上移动鼠标时，可能会触发一系列的移入移出事件，例如菜单的显示隐藏或提示框的弹出。使用函数节流可以控制鼠标移动事件的触发频率，避免频繁触发导致的性能问题